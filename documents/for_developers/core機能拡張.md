# Core機能 拡張・改善リスト

## 1. はじめに

このドキュメントは、「学習資料要件」で定義された理想の学習資料を実現するために、現在の`src/core`機能では不足している、あるいは改善が必要な機能をリストアップしたものです。

本文書は、以下の2つのカテゴリに分かれています。

1.  **既存機能の改善・正常化:** `core`に機能の雛形は存在するものの、不完全または正常に動作していないもの。
2.  **新規機能拡張:** `core`に存在しない、新たに追加が必要な機能。

---

## 2. 既存機能の改善・正常化

`CLAUDE.md`の未解決問題リストに基づき、以下の機能は正常な動作のために改善が必要です。

### 2.1. Mermaid.jsの表示機能

- **現状:** `DocumentBuilder`に`add_mermaid_block`メソッドは存在するが、実際には図としてレンダリングされず、コードブロックのまま表示される。
- **必要な改善:** `mkdocs-mermaid2-plugin`の初期化プロセスや、JavaScriptライブラリの読み込み順序などを詳細に調査し、Mermaid構文が正しく図に変換されるように修正する。`custom_fences`の設定だけでは不十分な、根本的な原因の解決が必要。

### 2.2. インタラクティブクイズ機能

- **現状:** `DocumentBuilder`に各種クイズ（単一選択、複数選択、カテゴリ分け）を生成するメソッドは存在するが、特に単一選択クイズが正常に動作しない。
- **必要な改善:** クイズのHTMLを生成するロジックと、その動作を制御するJavaScript（`quiz.js`など）、そしてデータソースであるYAMLファイル（`quizzes.yml`）の三者間で、データ構造やIDの受け渡しに不整合がないかを確認し、修正する。全てのクイズタイプが設計通りに動作するようにデバッグを行う。

### 2.3. 図表の表示問題

- **現状:** 3章の図表が表示されず、2章のテーブルは表示範囲が狭すぎる問題が報告されている。
- **必要な改善:** `ChartGenerator`や`TableGenerator`のHTML/CSS生成ロジックを見直し、データソース（CSV/YAML）のパス解決や、生成されるHTML/CSSに問題がないかを確認する。特に、テーブルのレスポンシブ対応や、iframeの高さ自動調整などのCSS/JSの挙動を再検証する。

---

## 3. 新規機能拡張

`IMPROVEMENT_PROPOSALS.md`で提案されている高度な機能を実現するため、以下の新規機能が必要です。

### 3.1. プラットフォーム機能

#### 3.1.1. 複数教材の連携
- **現状の限界:** 現在の`core`機能は、単一の教材（例: `test_material`）内での動作を前提としており、他の教材と連携する仕組みがない。
- **拡張内容:**
    - **総合用語集:** 複数の`materials`ディレクトリを横断的にスキャンし、全ての用語を集約して単一の用語集ページを生成する新しいスクリプトまたは`KnowledgeManager`の拡張機能。
    - **ラーニングパス:** 教材間の依存関係（前提知識、推奨次教材）を定義・解析し、サイトのトップページなどに可視化する機能。
    - **横断検索の補助:** 複数の教材をまたいだ検索結果を、JavaScriptで加工して教材名ラベルを付与するなど、UXを向上させる仕組み。

#### 3.1.2. 学習オブジェクトによるコンテンツ再利用
- **現状の限界:** コンテンツは章ごとのYAMLファイルに記述されており、章をまたいだコンテンツの再利用が考慮されていない。
- **拡張内容:**
    - `src/learning_objects`のような共通ディレクトリを新設。
    - `ContentManager`を拡張し、章のYAMLファイルから`object_id`のような参照を検知し、対応する学習オブジェクトのYAMLファイルをその場に展開してレンダリングする機能。

#### 3.1.3. 学習者からのフィードバック機能
- **現状の限界:** 学習者からのフィードバックを収集する標準的な仕組みがない。
- **拡張内容:**
    - `DocumentBuilder`に`add_feedback_form(form_url: str)`のようなメソッドを追加。Google FormsなどのURLを渡すだけで、定型的なフィードバックフォームのHTMLを簡単に埋め込めるようにする。

### 3.2. 開発・品質保証

#### 3.2.1. 自動テストスイートの導入
- **現状の限界:** プロジェクトに自動テストが存在せず、機能追加やリファクタリングが安全に行えない。
- **拡張内容:**
    - `pytest`を開発依存関係に追加。
    - `tests/`ディレクトリを新設し、`core`の各機能（`ChartGenerator`など）に対するユニットテストを整備。
    - 教材が正しく生成されるかを確認する統合テストを整備。
