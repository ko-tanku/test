# 学習プラットフォーム改善計画書（改訂版）

## 1. はじめに

このドキュメントは、現在の学習教材自動生成システムを、30種類以上の多様な教材に対応可能な、スケーラブルで高品質なプラットフォームへと進化させるための、具体的な実装手順を含む改善計画書です。**この文書は、プロジェクトの現状と今後の課題を反映した、唯一の信頼できる情報源（Single Source of Truth）です。**

---

## 2. 基本方針: 「関心の分離」の徹底

多数の教材追加を成功させる鍵は、**「データ・ロジック・見た目の完全分離」**と**「Core機能への責務集約」**です。これにより、拡張性、保守性、そして複数人での分業のしやすさを最大化します。

- **データ層 (`content/`)**: 教材に関する全てのデータをYAML形式で管理します。
- **見た目層 (`templates/`)**: 教材固有のCSS/JSをJinja2テンプレートで管理します。
- **ロジック層 (`contents.py`, `main.py`)**: Core機能を呼び出し、データと見た目を結合してコンテンツを生成する「司令塔」の役割を担います。
- **独自ロジック層 (`generators/`)**: Core機能でカバーできない、教材固有の特殊なロジックを格納する拡張ポイントです。

---

## 3. 完成イメージ: 改善後のプロジェクト構造

全ての改善が完了すると、プロジェクトは以下のような、責務が明確に分離された構造になります。

```
my-project/
├── data/                  # グラフ等で利用する共通のCSVデータを格納
├── docs/                  # 自動生成されたサイトコンテンツ（直接編集しない）
├── src/
│   ├── core/              # プラットフォームの共通コア機能
│   │   ├── __init__.py
│   │   ├── document_builder.py
│   │   ├── chart_generator.py
│   │   ├── platform_builder.py  # (新設) 複数教材を横断する機能を担当
│   │   └── ...
│   ├── materials/           # 各教材の個別実装
│   │   └── [material_name]/   # (例) c_language_intro
│   │       ├── __init__.py
│   │       ├── main.py        # 教材生成の起点（エントリーポイント）
│   │       ├── contents.py    # コンテンツ生成の司令塔
│   │       ├── content/       # データ層 (YAML)
│   │       │   ├── config.yml
│   │       │   ├── terms.yml
│   │       │   └── chapter1.yml
│   │       ├── templates/     # 見た目層 (Jinja2)
│   │       │   ├── custom.css.jinja
│   │       │   └── custom.js.jinja
│   │       └── generators/    # (拡張ポイント) 教材固有の独自ロジック
│   │           └── special_image_generator.py
│   └── ...
├── tests/                 # (新設) 自動テストコード
│   ├── core/
│   │   └── test_chart_generator.py
│   └── materials/
│       └── test_c_language_generation.py
├── mkdocs.yml             # MkDocs設定ファイル（main.py経由で自動生成）
└── requirements.txt       # 依存ライブラリ
```

---

## 4. 改善ロードマップ（改訂版 v2.0）

`PROJECT_BLUEPRINT.md`および`Core機能 詳細仕様書.md`で定義された理想形に基づき、ロードマップを以下のように再定義する。

### フェーズ1: 基盤の安定化（進行中）

**目的:** プロジェクトの技術的負債を解消し、安全に機能追加ができる安定した基盤を構築する。

#### 1.1: ビルドプロセスの正常化（最優先）
- **現状:** `src/materials/test_material/main.py` の実行時にエラーが発生し、ビルドが完了しない。
- **タスク:**
    1. ビルド時エラーを完全に解消し、`main.py`が正常終了するようにする。
    2. `docs/`配下に、意図されたすべてのMarkdownおよびHTMLファイルが正しく生成されることを確認する。

#### 1.2: 機能不具合の修正
- **現状:** ビルドが成功していないため、フロントエンドの不具合が未検証。
- **タスク:**
    1. ビルド成功後、`mkdocs serve`でローカルサーバーを起動する。
    2. 過去に報告されている以下の項目について、表示・動作確認を行い、問題があれば修正する。
        - **Mermaid.jsの表示問題:** 図がコードのまま表示されていないか。
        - **インタラクティブクイズの動作不良:** クイズが正常に動作し、答え合わせができるか。
        - **図表・テーブルの表示問題:** コンテンツがコンテナからはみ出したり、表示されなかったりしていないか。
        - **図表・テーブルの表示枠問題:** 図や表の表示枠が非常に狭く、内容が見えない。図や表の大きさに合わせて適切な領域を確保し、図や表内でのスクロール（`overflow`）を許可することで、ページの可読性を向上させる。
        - **ツールチップ機能の修正:** 第1章でツールチップが表示されない問題の修正。
        - **テーブル機能の修正:** 第2章でテーブルのクラスが認識されない問題の修正。
        - **Mermaid図機能の修正:** 第3章でグラフが表示される問題、第4章でコードブロックのまま表示される問題の修正。
        - **クイズ機能の修正:** 第4章でクイズが表示されない問題の修正。
        - **独自ジェネレータの修正:** 第5章で画像が表示されない問題の修正。

#### 1.3: 開発・品質保証基盤の構築（完了）
- **現状:** `pytest`の導入、`tests/`ディレクトリの作成、`ChartGenerator`の最初のユニットテスト作成が完了している。
- **今後の運用:** 新機能の追加や既存機能の修正を行う際は、必ず対応するユニットテストまたは統合テストを作成・更新する。
    - **変更管理の原則:**
        1.  **影響範囲の事前検討:** 修正や追加を行う前に、関連するモジュールや機能、ドキュメントへの影響範囲を事前に検討する。
        2.  **段階的な修正:** 可能な限り、影響範囲の小さい部分から段階的に修正を進めます。
        3.  **テストによる検証:** 修正後は、関連するテスト（ユニットテスト、統合テスト）を実行し、意図しない副作用が発生していないことを確認します。
        4.  **ドキュメントの同期:** 修正内容に応じて、関連するドキュメント（特に`Core機能 詳細仕様書.md`や`IMPROVEMENT_PROPOSALS.md`）を必ず更新し、コードとドキュメントの整合性を保つ。
- **タスク:**
    1. **クイズの網羅性:** `test_material`のクイズコンテンツを拡充し、`core`機能で提供される全てのクイズタイプ（単一選択、複数選択、カテゴリ分け）が正しく動作することを検証できるようにする。

---

### フェーズ2: `test_material` のリファクタリング

**目的:** `test_material`を、`PROJECT_BLUEPRINT.md`で定義された理想的な実装の「お手本」となるように修正する。

- **現状:** `main.py`にナビゲーション構造がハードコードされているなど、TODOコメントが多く残っており、設計思想を完全に反映できていない。
- **タスク:**
    1. **設定の外部化:** `main.py`内のハードコードされたナビゲーション構造などを、`content/config.yml`から動的に読み込むように修正する。
    2. **Core機能の活用:** `asset_generator.py`のテンプレート機能や、`knowledge_manager.py`のツールチップ機能などが、意図通りに活用されているか確認・修正する。
    3. **学習オブジェクトの導入:** `src/learning_objects`を活用するサンプルを`test_material`のコンテンツに追加し、コンテンツ再利用の具体的な実装例を示す。
    4. **YAMLファイル管理の改善:** 各資料で必ず実装される項目（演習問題、用語集、FAQ、TIPS）を章建てではなく、特別な名前のYAMLファイル（例: `exercises.yml`, `glossary.yml`, `faq.yml`, `tips.yml`）に分離して管理するように`test_material`のコンテンツ構造を修正する。これにより、コンテンツの統合と管理が容易になる。
    5. **用語集の関連性:** `test_material`の`content/terms.yml`を修正し、`test_material`の本文（第1章など）に登場する単語（「Core」「Material」など）のみを記載するようにする。

---

### フェーズ3: プラットフォーム機能の実装

**目的:** 複数の教材を横断する機能を追加し、単なるジェネレータから「プラットフォーム」へと進化させる。

- **現状:** `platform_builder.py`に機能の雛形はあるが、実装は空の状態。
- **タスク:**
    1. **総合用語集:** `platform_builder.py`に`generate_global_glossary`を実装する。
    2. **ラーニングパス:** `platform_builder.py`に`generate_learning_path`を実装する。
    3. **フィードバック機能:** `document_builder.py`の`add_feedback_form`メソッドを実装し、`test_material`内で利用例を示す。

---

### フェーズ4: UX（ユーザー体験）の向上

**目的:** 学習教材のインタラクティブ要素を、より直感的で発見しやすく、学習効果の高いものに改善する。

#### 4.1: ツールチップ機能の高度化
- **現状:** マウスホバーで表示されるが、モバイルで使いにくく、機能も限定的。
- **タスク:**
    1.  **クリックによる表示/非表示:** 表示トリガーをマウスホバーからクリックに変更し、再クリックで非表示になるトグル動作を実装する。
    2.  **排他表示:** 常に表示されるツールチップは一つだけになるように制御する。
    3.  **表示位置の自動調整:** ツールチップが画面の端で見切れないように、JavaScriptで表示位置を動的に調整するロジックを追加する。
    4.  **用語集への逆引きリンク:** 用語集ページに、各用語が本文中のどこで使用されているかを示すアンカーリンクのリスト（例: 「使用箇所: [第1章](#context-cpu-1)」）を自動生成する機能を`KnowledgeManager`に実装する。

#### 4.2: スライダー付きグラフの改善
- **現状:** スライダーでパラメータを変更すると、Y軸のスケールが自動調整され、グラフの変化が視覚的に分かりにくい。
- **タスク:**
    1. `chart_generator.py`の`create_slider_chart`メソッドを修正する。
    2. グラフ生成時にY軸の表示範囲を固定する`yaxis_range`オプションを追加する。
    3. この表示範囲は、YAMLの`config`セクションで教材ごとに設定できるようにする。

#### 4.3: Plotlyグラフの操作機能制限
- **目的:** Plotlyグラフのデフォルトのインタラクティブ機能のうち、ユーザーに操作方法を提示しておらず、意図しない動作を誘発するものを無効化する。これにより、学習者がコンテンツに集中できる環境を提供する。
- **タスク:**
    1. `chart_generator.py`内のPlotlyグラフを生成するメソッド（`create_simple_line_chart`, `create_bar_chart`, `create_scatter_chart`, `create_pie_chart`, `create_interactive_plotly_chart`など）を修正する。
    2. `fig.write_html()`メソッドの`config`引数を使用し、以下の操作機能を無効化する。
        - `modeBarButtonsToRemove`: ズーム、パン、オートスケール、リセットスケール、画像ダウンロードなどのボタンをモードバーから削除する。
        - `displayModeBar`: 必要に応じてモードバー自体を完全に非表示にする。
        - `scrollZoom`: マウスホイールによるズームを無効化する。
        - `doubleClick`: ダブルクリックによるオートスケールを無効化する。